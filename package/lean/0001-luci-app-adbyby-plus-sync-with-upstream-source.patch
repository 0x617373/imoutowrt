From 2181d2c5aa94d412dd0f91007616f9a5a409e84b Mon Sep 17 00:00:00 2001
From: Tianling Shen <cnsztl@gmail.com>
Date: Sat, 26 Dec 2020 00:10:00 +0800
Subject: [PATCH] luci-app-adbyby-plus: sync with upstream source

---
 package/lean/luci-app-adbyby-plus/Makefile    |  2 +-
 .../luasrc/model/cbi/adbyby/advanced.lua      |  4 +--
 .../luci-app-adbyby-plus/po/zh-cn/adbyby.po   |  4 +--
 .../root/etc/init.d/adbyby                    | 31 ++++++++++++++++---
 .../root/usr/share/adbyby/dnsmasq.adblock     |  0
 .../root/usr/share/adbyby/dnsmasq.ads         |  0
 .../root/usr/share/adbyby/dnsmasq.esc         |  0
 7 files changed, 31 insertions(+), 10 deletions(-)
 mode change 100755 => 100644 package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.adblock
 mode change 100755 => 100644 package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.ads
 mode change 100755 => 100644 package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.esc

diff --git a/package/lean/luci-app-adbyby-plus/Makefile b/package/lean/luci-app-adbyby-plus/Makefile
index 72b46f68c4..40ad1e9aad 100644
--- a/package/lean/luci-app-adbyby-plus/Makefile
+++ b/package/lean/luci-app-adbyby-plus/Makefile
@@ -10,7 +10,7 @@ LUCI_DEPENDS:=+adbyby +wget +ipset +dnsmasq-full
 LUCI_PKGARCH:=all
 PKG_NAME:=luci-app-adbyby-plus
 PKG_VERSION:=2.0
-PKG_RELEASE:=72
+PKG_RELEASE:=73
 
 include $(TOPDIR)/feeds/luci/luci.mk
 
diff --git a/package/lean/luci-app-adbyby-plus/luasrc/model/cbi/adbyby/advanced.lua b/package/lean/luci-app-adbyby-plus/luasrc/model/cbi/adbyby/advanced.lua
index b8991d06ff..220943efb5 100644
--- a/package/lean/luci-app-adbyby-plus/luasrc/model/cbi/adbyby/advanced.lua
+++ b/package/lean/luci-app-adbyby-plus/luasrc/model/cbi/adbyby/advanced.lua
@@ -22,8 +22,8 @@ o.title = translate("Block Apple iOS OTA update")
 o.default = 0
 o.rmempty = false
 
-o = s:option(Flag, "block_douyin")
-o.title = translate("Block Douyin APP and Website")
+o = s:option(Flag, "block_cnshort")
+o.title = translate("Block CNshort APP and Website")
 o.default = 0
 o.rmempty = false
 
diff --git a/package/lean/luci-app-adbyby-plus/po/zh-cn/adbyby.po b/package/lean/luci-app-adbyby-plus/po/zh-cn/adbyby.po
index dc27f32cbb..f82a0b38c2 100644
--- a/package/lean/luci-app-adbyby-plus/po/zh-cn/adbyby.po
+++ b/package/lean/luci-app-adbyby-plus/po/zh-cn/adbyby.po
@@ -125,8 +125,8 @@ msgstr "手动更新规则"
 msgid "Block Apple iOS OTA update"
 msgstr "拦截 Apple iOS 的OTA更新"
 
-msgid "Block Douyin APP and Website"
-msgstr "拦截 抖音 APP 和网站"
+msgid "Block CNshort APP and Website"
+msgstr "拦截 短视频 APP 和网站"
 
 msgid "RAM Running Mode"
 msgstr "内存运行模式"
diff --git a/package/lean/luci-app-adbyby-plus/root/etc/init.d/adbyby b/package/lean/luci-app-adbyby-plus/root/etc/init.d/adbyby
index 0156d04228..5e1274e08c 100755
--- a/package/lean/luci-app-adbyby-plus/root/etc/init.d/adbyby
+++ b/package/lean/luci-app-adbyby-plus/root/etc/init.d/adbyby
@@ -36,7 +36,7 @@ get_config()
 	config_get wan_mode $1 wan_mode 1
 	config_get_bool block_ios $1 block_ios 0
 	config_get_bool mem_mode $1 mem_mode 1
-	config_get_bool block_douyin $1 block_douyin 0
+	config_get_bool block_cnshort $1 block_cnshort 0
 }
 
 add_rules()
@@ -85,8 +85,6 @@ ip_rule()
 		esac
 	done
 
-
-
 	case $wan_mode in
 		0)
 			;;
@@ -134,11 +132,34 @@ add_dns()
 	echo 'conf-dir=/tmp/adbyby/rules/data' >> /tmp/dnsmasq.d/dnsmasq-adbyby.conf
 
   [ $block_ios -eq 1 ] && echo 'address=/mesu.apple.com/0.0.0.0' >> /tmp/dnsmasq.d/dnsmasq-adbyby.conf
-  if [ $block_douyin -eq 1 ]; then
-  cat <<-EOF >/tmp/etc/dnsmasq-adbyby.d/08-dnsmasq.douyin
+  if [ $block_cnshort -eq 1 ]; then
+  cat <<-EOF >/tmp/etc/dnsmasq-adbyby.d/08-dnsmasq.cnshort
 address=/api.amemv.com/0.0.0.0
+address=/.amemv.com/0.0.0.0
+address=/.tiktokv.com/0.0.0.0
 address=/.snssdk.com/0.0.0.0
 address=/.douyin.com/0.0.0.0
+address=/.ixigua.com/0.0.0.0
+address=/.pstatp.com/0.0.0.0
+address=/.ixiguavideo.com/0.0.0.0
+address=/.v.kandian.qq.com/0.0.0.0
+address=/.yximgs.com/0.0.0.0
+address=/.gifshow.com/0.0.0.0
+address=/.ksapisrv.com/0.0.0.0
+address=/.kuaishoupay.com/0.0.0.0
+address=/.ksyun.com/0.0.0.0
+address=/.live.xycdn.com/0.0.0.0
+address=/.danuoyi.alicdn.com/0.0.0.0
+address=/.v.weishi.qq.com/0.0.0.0
+address=/.pearvideo.com/0.0.0.0
+address=/.miaopai.com/0.0.0.0
+address=/.kuaishou.com/0.0.0.0
+address=/.qupai.me/0.0.0.0
+address=/.meipai.com/0.0.0.0
+address=/.huoshan.com/0.0.0.0
+address=/.ergengtv.com/0.0.0.0
+address=/.baijiahao.baidu.com/0.0.0.0
+address=/.xiongzhang.baidu.com/0.0.0.0
 		EOF
 	fi
 }
diff --git a/package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.adblock b/package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.adblock
old mode 100755
new mode 100644
diff --git a/package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.ads b/package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.ads
old mode 100755
new mode 100644
diff --git a/package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.esc b/package/lean/luci-app-adbyby-plus/root/usr/share/adbyby/dnsmasq.esc
old mode 100755
new mode 100644
-- 
2.20.1

